#!/usr/bin/env bash
# @describe CLI Command Palette
# Execute a command from launcherrc.

set -eu

CONFIG_FILE="${XDG_CONFIG_HOME:-$HOME/.config}/launcherrc"
mkdir -p "$(dirname "$CONFIG_FILE")"
if [[ ! -e "$CONFIG_FILE" ]]; then
	cat <<-EOF > "$CONFIG_FILE"
	# Launcher configuration file
	# Entries should be in the form NAME:SCRIPT
	# Example:
	# Start program:cd dir; pwd
	EOF
fi

main() {
	cmd=$(grep -Ev "^#" "$CONFIG_FILE" | \
		fzf -d '\t' --with-nth 1 | \
		cut -d $'\t' -f 2-)
	eval "$cmd"
}

if ! command -v argc >/dev/null; then
	echo "This command requires argc. Install from https://github.com/sigoden/argc" >&2
	exit 100
fi
eval "$(argc --argc-eval "$0" "$@")"
